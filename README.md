# Radio Stream Server

–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ–π Go-—Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å–∫–∞–Ω–∏—Ä—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ (`.mp3`, `.aac`, `.ogg`) —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ, –ø–µ—Ä–µ–∫–æ–¥–∏—Ä—É–µ—Ç –∏—Ö –≤ –∑–∞–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ –±–∏—Ç—Ä–µ–π—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `mp3@96kbps`), –∏ —Ä–∞–∑–¥–∞—ë—Ç –∫–∞–∫ –ø–æ—Ç–æ–∫–æ–≤–æ–µ —Ä–∞–¥–∏–æ –ø–æ HTTP. –î–ª—è –∫–∞–∂–¥–æ–π –ø–∞–ø–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–≤–æ—è —Å—Ç–∞–Ω—Ü–∏—è, –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –æ–±—Ä–∞–∑—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏. –ü–æ—Ç–æ–∫ –µ–¥–∏–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (live-—Ä–µ–∂–∏–º).

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –°—Ç—Ä–∏–º–∏–Ω–≥ —á–µ—Ä–µ–∑ HTTP –ø–æ TCP: `/stream/:station`
- `/stations` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç–∞–Ω—Ü–∏–π (–ø–∞–ø–æ–∫)
- `/nowplaying/:station` ‚Äî —Ç–µ–∫—É—â–∏–π —Ç—Ä–µ–∫
- `/` ‚Äî –ø—Ä–æ—Å—Ç–∞—è —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7 —Å–µ–∫—É–Ω–¥)
- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∞ —Ç—Ä–µ–∫–æ–≤ —á–µ—Ä–µ–∑ `ffmpeg`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –Ω–∞ —Å—Ç–∞–Ω—Ü–∏—é (—ç–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤)
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏:
1. `config.yaml` ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
2. ENV-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `config.yaml`

### –ü—Ä–∏–º–µ—Ä `config.yaml`

```yaml
ffmpeg_path: /usr/bin/ffmpeg
output_format: mp3
output_bitrate: 96k
music_dir: ./music
cache_dir: ./.cache
buffer_seconds: 7
listen: ":8080"
```

### ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–≤—Å–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----------|----------|
| `FFMPEG_PATH` | –ü—É—Ç—å –¥–æ ffmpeg |
| `OUTPUT_FORMAT` | –§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (`mp3`, `aac`, `ogg`) |
| `OUTPUT_BITRATE` | –ù–∞–ø—Ä–∏–º–µ—Ä `96k` |
| `MUSIC_DIR` | –ü–∞–ø–∫–∞ —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ —Ç—Ä–µ–∫–∞–º–∏ |
| `CACHE_DIR` | –ü–∞–ø–∫–∞ —Å –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ |
| `BUFFER_SECONDS` | –ö–æ–ª-–≤–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ |
| `LISTEN` | –ü–æ—Ä—Ç –∏ IP (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `:8080`) |

## üê≥ Docker (–¥–ª—è MikroTik)

```Dockerfile
FROM golang:1.22-alpine

RUN apk add --no-cache ffmpeg
WORKDIR /app
COPY . .

RUN go build -o radiod ./cmd/radiod

EXPOSE 8080
CMD ["./radiod"]
```

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
cmd/radiod         # main
internal/server    # HTTP —Ä–æ—É—Ç—ã
internal/stream    # –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è
internal/convert   # ffmpeg –æ–±—ë—Ä—Ç–∫–∞
internal/config    # –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤
web/               # —Å—Ç–∞—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –Ω–∞–¥–æ)
```

## üîó –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `/` ‚Äî HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º —Å—Ç–∞–Ω—Ü–∏–π
- `/stations` ‚Äî JSON –º–∞—Å—Å–∏–≤: `["pop", "rock", "electro"]`
- `/nowplaying/:station` ‚Äî JSON: `{ "now": "track1.mp3" }`
- `/stream/:station` ‚Äî HTTP-–ø–æ—Ç–æ–∫ `audio/mpeg`/...

